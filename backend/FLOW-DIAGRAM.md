# ğŸ¯ Fluxo Visual - Backend Aevalo

RepresentaÃ§Ã£o visual do fluxo completo de avaliaÃ§Ã£o.

---

## ğŸ”„ Fluxo Completo End-to-End

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                           â”‚
â”‚                   FLUXO DE AVALIAÃ‡ÃƒO - AEVALO 360Â°                      â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
FASE 1: CRIAÃ‡ÃƒO (Owner)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ğŸ‘¤ Owner (Criador)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Step 1: Acessa Dashboard                â”‚
    â”‚ GET /evaluations                         â”‚
    â”‚ â”œâ”€ count(avaliaÃ§Ãµes) = 0?               â”‚
    â”‚ â”œâ”€ is_first_time = true                 â”‚
    â”‚ â””â”€ Exibe Empty State CTA                â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Step 2-3: Cria AvaliaÃ§Ã£o                â”‚
    â”‚ POST /evaluations                        â”‚
    â”‚ â”œâ”€ {title, description, scale_type}     â”‚
    â”‚ â”œâ”€ INSERT (status: Draft)               â”‚
    â”‚ â””â”€ Retorna: Evaluation                  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
         â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
         â†“         â†“
    [OpÃ§Ã£o A]   [OpÃ§Ã£o B]
    Template     IA
        â†“         â†“
    [select]   [describe]
        â”‚         â”‚
        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
             â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Step 3-alt B: GeraÃ§Ã£o com IA            â”‚
    â”‚ POST /evaluations/generate              â”‚
    â”‚ â”œâ”€ POST â†’ Gemini API                    â”‚
    â”‚ â”œâ”€ build_prompt(desc, scale)            â”‚
    â”‚ â”œâ”€ parse_gemini_response()              â”‚
    â”‚ â””â”€ Retorna: items + metadata            â”‚
    â”‚                                          â”‚
    â”‚ POST /evaluations/validate              â”‚
    â”‚ â”œâ”€ Valida structure                     â”‚
    â”‚ â””â”€ Retorna: errors[]                    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Step 4: Customiza AvaliaÃ§Ã£o             â”‚
    â”‚ PATCH /evaluations/{id}                  â”‚
    â”‚ â”œâ”€ UPDATE title, description            â”‚
    â”‚ â”œâ”€ INSERT/UPDATE questions              â”‚
    â”‚ â””â”€ Retorna: Evaluation updated          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Step 5: Publica AvaliaÃ§Ã£o               â”‚
    â”‚ POST /evaluations/{id}/publish          â”‚
    â”‚ â”œâ”€ INSERT questions                     â”‚
    â”‚ â”œâ”€ UPDATE status = Open                 â”‚
    â”‚ â”œâ”€ Gera UUID + short_url                â”‚
    â”‚ â”œâ”€ INSERT public_links                  â”‚
    â”‚ â””â”€ Retorna: PublishResponse + link      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Step 6: Compartilha Link                â”‚
    â”‚ ğŸ“‹ Copy to clipboard                    â”‚
    â”‚ ğŸ“¨ Send to evaluators                   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
FASE 2: COLETA PARALELA (MÃºltiplos Avaliadores)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Link PÃºblico: /public/eval/{uuid}
        â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â†“                 â†“                 â†“                 â†“
   
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ ğŸ‘¥ Avaliador â”‚  â”‚ ğŸ‘¥ Avaliador â”‚  â”‚ ğŸ‘¥ Avaliador â”‚
   â”‚      1       â”‚  â”‚      2       â”‚  â”‚      3       â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                 â”‚                 â”‚
        â†“ Step 7          â†“ Step 7          â†“ Step 7
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ GET /public/eval/{uuid}
   â”‚ â”œâ”€ Valida UUID
   â”‚ â”œâ”€ Valida status = Open
   â”‚ â””â”€ Retorna: Questions
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚ (x3)
        â†“ Step 8-9 (paralelo)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ POST /responses                      â”‚
   â”‚ â”œâ”€ Valida: avaliaÃ§Ã£o aberta         â”‚
   â”‚ â”œâ”€ validate_answers(scale_type)     â”‚
   â”‚ â”œâ”€ INSERT (anonymizado)             â”‚
   â”‚ â””â”€ Retorna: âœ“ ConfirmaÃ§Ã£o           â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚ (3x paralelo)
        â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                  â”‚
        â†“ Step 10                          â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ GET /evaluations/{id}/stats           â”‚ Real-time
   â”‚ â”œâ”€ COUNT responses                    â”‚ Dashboard
   â”‚ â”œâ”€ response_rate                      â”‚
   â”‚ â””â”€ Retorna: stats                     â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
FASE 3: FINALIZAÃ‡ÃƒO E ANÃLISE (Owner)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Step 11: Finaliza AvaliaÃ§Ã£o             â”‚
    â”‚ POST /evaluations/{id}/close            â”‚
    â”‚ â”œâ”€ UPDATE status = Closed               â”‚
    â”‚ â”œâ”€ UPDATE public_links.is_active        â”‚
    â”‚ â””â”€ Dispara: Analytics                   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Step 11.3: Processamento AutomÃ¡tico     â”‚
    â”‚ compute_analytics()                     â”‚
    â”‚                                          â”‚
    â”‚ â”œâ”€ Fetch respostas                      â”‚
    â”‚ â”œâ”€ Loop por questÃ£o                     â”‚
    â”‚ â”‚  â”œâ”€ Fetch answers                     â”‚
    â”‚ â”‚  â”œâ”€ ValidaÃ§Ã£o por scale_type          â”‚
    â”‚ â”‚  â”œâ”€ CÃ¡lculos:                         â”‚
    â”‚ â”‚  â”‚  â”œâ”€ Likert: mean, median, std_dev â”‚
    â”‚ â”‚  â”‚  â”œâ”€ FixedSum: weighted avg        â”‚
    â”‚ â”‚  â”‚  â””â”€ Paired: ranking                â”‚
    â”‚ â”‚  â””â”€ Histograma + confidence           â”‚
    â”‚ â”œâ”€ Armazena em analytics_results        â”‚
    â”‚ â””â”€ Retorna: AnalyticsResult             â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Step 12: Visualiza Resultados           â”‚
    â”‚ GET /evaluations/{id}/results           â”‚
    â”‚ â”œâ”€ Fetch: analytics_results             â”‚
    â”‚ â”œâ”€ Retorna: mÃ©tricas formatadas         â”‚
    â”‚ â””â”€ Exibe: GrÃ¡ficos + tabelas            â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ESTRUTURA DE HANDLERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Request HTTP
    â†“
    â”œâ”€ Axum Router (main.rs)
    â”‚   â”œâ”€ Path matching
    â”‚   â””â”€ State injection
    â†“
Handlers Module
    â”œâ”€ evaluations.rs      (CRUD)        â† 389 linhas
    â”œâ”€ responses.rs        (Coleta)      â† 318 linhas
    â”œâ”€ public.rs           (PÃºblico)     â† 116 linhas
    â”œâ”€ ai_generation.rs    (IA)          â† 254 linhas
    â”œâ”€ analytics.rs        (AnÃ¡lise)     â† 410 linhas
    â””â”€ auth.rs             (Auth)        â† 27 linhas
    â†“
Input Validation & Business Logic
    â”œâ”€ Serde JSON deserialization
    â”œâ”€ Type validation
    â”œâ”€ Scale-specific checks
    â””â”€ Database constraints
    â†“
Database Layer
    â”œâ”€ SQLx queries
    â”œâ”€ Connection pooling
    â”œâ”€ RLS policies (Supabase)
    â””â”€ Transactions
    â†“
Response Formatting
    â”œâ”€ HTTP status code
    â”œâ”€ JSON serialization
    â””â”€ Client
```

---

## ğŸ“Š Fluxo de ValidaÃ§Ã£o

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Input: POST /responses               â”‚
â”‚ {                                    â”‚
â”‚   respondent_id: "hash-ip",         â”‚
â”‚   answers: [                         â”‚
â”‚     {q_id: "...", answer_value: 4}  â”‚
â”‚   ]                                  â”‚
â”‚ }                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Serde: Parse JSON               â”‚
    â”‚ âœ“ Type safety garantida         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Handler: submit_responses()      â”‚
    â”‚ â”œâ”€ answers.is_empty()? â†’ erro   â”‚
    â”‚ â””â”€ evaluation_id lookup          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Query: Status = Open?            â”‚
    â”‚ â”œâ”€ No â†’ 400 ValidationError     â”‚
    â”‚ â””â”€ Yes â†’ continue               â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ validate_answers()              â”‚
    â”‚ GET scale_type                  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Match scale_type:                        â”‚
    â”‚                                          â”‚
    â”‚ "Likert" â†’ check 1-5                     â”‚
    â”‚ "FixedSum" â†’ check sum = 100             â”‚
    â”‚ "Paired" â†’ validate matrix               â”‚
    â”‚ "Frequency" â†’ validate categories        â”‚
    â”‚                                          â”‚
    â”‚ âœ“ All valid â†’ continue                   â”‚
    â”‚ âœ— Invalid â†’ return 400                   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ INSERT responses                â”‚
    â”‚ (anonymizado com respondent_id) â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Response: 201 Created           â”‚
    â”‚ {                               â”‚
    â”‚   message: "âœ“ Obrigado",        â”‚
    â”‚   response_count: 5             â”‚
    â”‚ }                               â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ˆ Fluxo de Analytics

```
POST /evaluations/{id}/close
        â†“
UPDATE evaluations status = Closed
        â†“
Dispara: POST /evaluations/{id}/process
        â†“
compute_analytics(eval_id)
    â”‚
    â”œâ”€ Fetch evaluation metadata
    â”œâ”€ COUNT total responses
    â”‚
    â”œâ”€ LOOP: Para cada questÃ£o
    â”‚   â”‚
    â”‚   â”œâ”€ compute_question_metrics(q_id)
    â”‚   â”‚   â”‚
    â”‚   â”‚   â”œâ”€ Fetch todas responses
    â”‚   â”‚   â”‚
    â”‚   â”‚   â”œâ”€ Match scale_type
    â”‚   â”‚   â”‚   â”‚
    â”‚   â”‚   â”‚   â”œâ”€ "Likert" / "FixedSum"
    â”‚   â”‚   â”‚   â”‚   â””â”€ compute_numeric_statistics()
    â”‚   â”‚   â”‚   â”‚       â”œâ”€ Mean
    â”‚   â”‚   â”‚   â”‚       â”œâ”€ Median
    â”‚   â”‚   â”‚   â”‚       â”œâ”€ Std Dev
    â”‚   â”‚   â”‚   â”‚       â”œâ”€ Min/Max
    â”‚   â”‚   â”‚   â”‚       â”œâ”€ Distribution
    â”‚   â”‚   â”‚   â”‚       â””â”€ Confidence Score
    â”‚   â”‚   â”‚   â”‚
    â”‚   â”‚   â”‚   â””â”€ "PairedComparison"
    â”‚   â”‚   â”‚       â””â”€ compute_comparison_statistics()
    â”‚   â”‚   â”‚           â”œâ”€ Win counts
    â”‚   â”‚   â”‚           â”œâ”€ Ranking
    â”‚   â”‚   â”‚           â””â”€ Confidence Score
    â”‚   â”‚   â”‚
    â”‚   â”‚   â””â”€ Retorna: QuestionMetrics
    â”‚   â”‚
    â”‚   â””â”€ Salva em question_metrics[]
    â”‚
    â”œâ”€ Agrega mÃ©tricas
    â”‚
    â”œâ”€ INSERT analytics_results
    â”‚   {
    â”‚     evaluation_id,
    â”‚     total_responses,
    â”‚     metrics: {
    â”‚       by_question: [...],
    â”‚       summary: {...}
    â”‚     }
    â”‚   }
    â”‚
    â””â”€ Retorna: AnalyticsResult

GET /evaluations/{id}/results
        â†“
SELECT metrics FROM analytics_results
        â†“
Retorna: ResultsResponse
```

---

## ğŸ” Fluxo de SeguranÃ§a

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Autenticado (JWT)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                       â”‚
â”‚  POST /evaluations                                    â”‚
â”‚  â”œâ”€ Token required                                    â”‚
â”‚  â”œâ”€ Extract user_id from JWT                         â”‚
â”‚  â”œâ”€ INSERT evaluation with user_id                   â”‚
â”‚  â””â”€ Ownership: automatic (user_id = token.user_id)   â”‚
â”‚                                                       â”‚
â”‚  GET /evaluations/{id}                                â”‚
â”‚  â”œâ”€ Token required                                    â”‚
â”‚  â”œâ”€ Query: WHERE id=$1 AND user_id=$2                â”‚
â”‚  â””â”€ RLS: row-level security on Supabase              â”‚
â”‚                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               PÃºblico (Sem AutenticaÃ§Ã£o)              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                       â”‚
â”‚  GET /public/eval/{uuid}                              â”‚
â”‚  â”œâ”€ No token required                                â”‚
â”‚  â”œâ”€ Query: SELECT evaluation_id FROM public_links    â”‚
â”‚  â”‚   WHERE uuid=$1 AND is_active=true                â”‚
â”‚  â”œâ”€ Second query: SELECT * FROM evaluations          â”‚
â”‚  â”‚   WHERE id=$1 AND status='Open'                   â”‚
â”‚  â””â”€ Return: tÃ­tulo, descriÃ§Ã£o, questÃµes              â”‚
â”‚                                                       â”‚
â”‚  POST /responses                                      â”‚
â”‚  â”œâ”€ No token required                                â”‚
â”‚  â”œâ”€ respondent_id: anonymizado (hash de IP)          â”‚
â”‚  â”œâ”€ ValidaÃ§Ã£o: avaliaÃ§Ã£o aberta                      â”‚
â”‚  â””â”€ INSERT sem user_id                               â”‚
â”‚                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¤– Fluxo de IA

```
User Input
    â†“
"Avaliar desempenho da equipe"
    â†“
POST /evaluations/generate
    â†“
generate_items_ai()
    â”‚
    â”œâ”€ Determine scale_type
    â”‚
    â”œâ”€ call_gemini_api()
    â”‚   â”‚
    â”‚   â”œâ”€ build_prompt()
    â”‚   â”‚   â”œâ”€ Description
    â”‚   â”‚   â”œâ”€ Scale type instructions
    â”‚   â”‚   â””â”€ JSON format specification
    â”‚   â”‚
    â”‚   â”œâ”€ HTTP POST to Gemini API
    â”‚   â”‚   {
    â”‚   â”‚     "contents": [{
    â”‚   â”‚       "parts": [{"text": prompt}]
    â”‚   â”‚     }]
    â”‚   â”‚   }
    â”‚   â”‚
    â”‚   â”œâ”€ Response streaming
    â”‚   â”‚
    â”‚   â””â”€ parse_gemini_response()
    â”‚       â”œâ”€ Extract text from response
    â”‚       â”œâ”€ JSON parse
    â”‚       â””â”€ Add default metadata if empty
    â”‚
    â”œâ”€ Retorna: GeneratedItem[]
    â”‚   [
    â”‚     {
    â”‚       order: 1,
    â”‚       text: "Communication skills...",
    â”‚       metadata: {
    â”‚         min_value: 1,
    â”‚         max_value: 5,
    â”‚         labels: ["Disagree", ..., "Agree"]
    â”‚       }
    â”‚     }
    â”‚   ]
    â”‚
    â””â”€ POST /evaluations/validate
        â”œâ”€ Check item count
        â”œâ”€ Validate order sequence
        â”œâ”€ Check scale constraints
        â””â”€ Retorna: is_valid + errors[]
```

---

## ğŸ”„ Database Schema (Simplificado)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     evaluations              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (UUID) PRIMARY KEY        â”‚
â”‚ user_id (UUID) [FK]          â”‚
â”‚ title (VARCHAR)              â”‚
â”‚ status (ENUM)                â”‚
â”‚ scale_type (ENUM)            â”‚
â”‚ created_at, updated_at       â”‚
â”‚ published_at, closed_at      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“ 1:N
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     questions                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (UUID) PRIMARY KEY        â”‚
â”‚ evaluation_id (FK)           â”‚
â”‚ order (INT) [UNIQUE pair]    â”‚
â”‚ text (TEXT)                  â”‚
â”‚ metadata (JSONB)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“ 1:N
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     responses                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (UUID) PRIMARY KEY        â”‚
â”‚ question_id (FK)             â”‚
â”‚ respondent_id (VARCHAR)      â”‚
â”‚ answer_value (JSONB)         â”‚
â”‚ created_at (TIMESTAMP)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   public_links               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (UUID) PRIMARY KEY        â”‚
â”‚ evaluation_id (UUID) UNIQUE  â”‚
â”‚ uuid (VARCHAR) UNIQUE        â”‚
â”‚ short_url (VARCHAR)          â”‚
â”‚ is_active (BOOLEAN)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ analytics_results            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (UUID) PRIMARY KEY        â”‚
â”‚ evaluation_id (FK) UNIQUE    â”‚
â”‚ total_responses (INT)        â”‚
â”‚ response_rate (FLOAT)        â”‚
â”‚ metrics (JSONB)              â”‚
â”‚ generated_at (TIMESTAMP)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```